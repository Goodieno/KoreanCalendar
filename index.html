<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tapdong TV Calendar</title>

<style>

/* ================= BASIC ================= */

body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #0f172a;
    color: white;
}

.container {
    display: grid;
    grid-template-columns: 3fr 1fr;
    height: 100vh;
}

/* ================= CALENDAR ================= */

.calendar {
    padding: 30px;
}

.header {
    text-align: center;
    font-size: 48px;
    margin-bottom: 20px;
}

.weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-size: 34px;
    font-weight: bold;
}

.weekdays div {
    padding: 10px;
}

.sun { color: red; }
.sat { color: #60a5fa; }

.days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    grid-auto-rows: 110px;
    gap: 6px;
    margin-top: 10px;
}

.day {
    background: #1e293b;
    border-radius: 12px;
    padding: 10px;
    position: relative;
    font-size: 34px;
}

.day.red {
    color: red;
}

.holiday {
    font-size: 16px;
    margin-top: 4px;
    color: #f87171;
}

/* ================= TODAY PULSE ================= */

.today {
    border: 4px solid red;
    box-shadow: 0 0 20px red;
    animation: pulse 1.8s infinite;
}

.today::after {
    content: "";
    position: absolute;
    width: 26px;
    height: 26px;
    border: 4px solid red;
    border-radius: 50%;
    top: 6px;
    right: 6px;
}

@keyframes pulse {
    0% { box-shadow: 0 0 5px red; }
    50% { box-shadow: 0 0 25px red; }
    100% { box-shadow: 0 0 5px red; }
}

/* ================= SIDEBAR ================= */

.sidebar {
    background: #020617;
    padding: 30px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.clock {
    text-align: center;
    font-size: 56px;
    margin-bottom: 30px;
}

.info-box {
    background: #1e293b;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
}

.info-box h3 {
    margin: 0 0 10px;
    font-size: 22px;
    text-align: center;
}

.info-box p {
    margin: 5px 0;
    font-size: 20px;
    text-align: center;
}

</style>
</head>

<body>

<div class="container">

<!-- ================= CALENDAR ================= -->

<div class="calendar">

    <div class="header" id="monthYear"></div>

    <div class="weekdays">
        <div class="sun">Ïùº</div>
        <div>Ïõî</div>
        <div>Ìôî</div>
        <div>Ïàò</div>
        <div>Î™©</div>
        <div>Í∏à</div>
        <div class="sat">ÌÜ†</div>
    </div>

    <div class="days" id="days"></div>

</div>

<!-- ================= SIDEBAR ================= -->

<div class="sidebar">

    <div>

        <div class="clock" id="clock"></div>

        <div class="info-box">
            <h3>üå§ Weather</h3>
            <p id="weather">Loading...</p>
        </div>

        <div class="info-box">
            <h3>üò∑ Air Quality</h3>
            <p id="air">Loading...</p>
        </div>

    </div>

    <div style="text-align:center;font-size:14px;opacity:0.6">
        Dangjin ‚Ä¢ Korea
    </div>

</div>

</div>

<script>

/* ================= SETTINGS ================= */

const API_KEY = "fa9fe37b9be14839fe6774643939e974";
const CITY = "Dangjin-si,KR";
const COUNTRY = "KR";

/* ================= DATE ================= */

let now = new Date();
let month = now.getMonth();
let year = now.getFullYear();

const today = new Date();

/* ================= HOLIDAYS ================= */

let holidays = {};

/* ================= CALENDAR ================= */

function renderCalendar() {

    const daysEl = document.getElementById("days");
    const header = document.getElementById("monthYear");

    daysEl.innerHTML = "";

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    header.textContent =
        `${year}ÎÖÑ ${month + 1}Ïõî`;

    // Empty cells
    for (let i = 0; i < firstDay; i++) {
        daysEl.appendChild(document.createElement("div"));
    }

    for (let day = 1; day <= lastDate; day++) {

        const cell = document.createElement("div");
        cell.classList.add("day");

        const dateStr =
            `${year}-${String(month+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;

        cell.innerHTML = `<div>${day}</div>`;

        // Sunday
        if ((firstDay + day - 1) % 7 === 0) {
            cell.classList.add("red");
        }

        // Today
        if (
            day === today.getDate() &&
            month === today.getMonth() &&
            year === today.getFullYear()
        ) {
            cell.classList.add("today");
        }

        // Holidays
        if (holidays[dateStr]) {

            cell.classList.add("red");

            holidays[dateStr].forEach(name => {
                const h = document.createElement("div");
                h.className = "holiday";
                h.textContent = name;
                cell.appendChild(h);
            });
        }

        daysEl.appendChild(cell);
    }
}

/* ================= HOLIDAY API ================= */

async function loadHolidays() {

    try {

        const url =
`https://date.nager.at/api/v3/PublicHolidays/${year}/KR`;

        const res = await fetch(url);
        const data = await res.json();

        holidays = {};

        data.forEach(h => {

            if (!holidays[h.date]) {
                holidays[h.date] = [];
            }

            holidays[h.date].push(h.localName);

        });

        renderCalendar();

    } catch {

        console.log("Holiday API error");
        renderCalendar();
    }
}

/* ================= CLOCK ================= */

function updateClock() {

    const now = new Date();

    let h = now.getHours();
    const m = String(now.getMinutes()).padStart(2, "0");
    const s = String(now.getSeconds()).padStart(2, "0");

    const ampm = h >= 12 ? "PM" : "AM";

    // Convert to 12-hour format
    h = h % 12;
    h = h ? h : 12; // 0 becomes 12

    document.getElementById("clock").textContent =
        `${h}:${m}:${s} ${ampm}`;
}

setInterval(updateClock, 1000);
updateClock();

/* ================= WEATHER ================= */

async function loadWeather() {

    try {

        const url =
`https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric`;

        const res = await fetch(url);
        const data = await res.json();

        document.getElementById("weather").textContent =
            `${data.weather[0].main} / ${data.main.temp.toFixed(1)}¬∞C`;

    } catch {
        document.getElementById("weather").textContent = "Unavailable";
    }
}

/* ================= AIR ================= */

async function loadAir() {

    try {

        const geo =
`https://api.openweathermap.org/geo/1.0/direct?q=${CITY}&limit=1&appid=${API_KEY}`;

        const geoRes = await fetch(geo);
        const geoData = await geoRes.json();

        const lat = geoData[0].lat;
        const lon = geoData[0].lon;

        const url =
`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`;

        const res = await fetch(url);
        const data = await res.json();

        const aqi = data.list[0].main.aqi;

        const levels = ["Good","Fair","Moderate","Poor","Very Poor"];

        document.getElementById("air").textContent =
            levels[aqi-1];

    } catch {

        document.getElementById("air").textContent = "Unavailable";
    }
}

/* ================= AUTO MIDNIGHT RELOAD ================= */

function scheduleReload() {

    const now = new Date();
    const midnight = new Date();

    midnight.setHours(24,0,0,0);

    setTimeout(() => {
        location.reload();
    }, midnight - now);
}

/* ================= START ================= */

loadHolidays();
loadWeather();
loadAir();
scheduleReload();

</script>

</body>
</html>
